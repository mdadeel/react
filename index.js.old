#!/usr/bin/env node

import inquirer from 'inquirer';
import chalk from 'chalk';
import ora from 'ora';
import { execSync } from 'child_process';
import fs from 'fs-extra';
import path from 'path';

// Ultra Modern ASCII Art Banner with Gradient Effect
const banner = `
${chalk.hex('#FF6B6B')('‚ïî')}${chalk.hex('#FFA07A')('‚ïê'.repeat(63))}${chalk.hex('#FFD93D')('‚ïó')}
${chalk.hex('#FF6B6B')('‚ïë')}${' '.repeat(63)}${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}   ${chalk.hex('#00D9FF').bold('‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó')}        ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}   ${chalk.hex('#00D9FF').bold('‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù')}        ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}   ${chalk.hex('#4ECDC4').bold('‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë        ‚ñà‚ñà‚ïë   ')}        ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}   ${chalk.hex('#95E1D3').bold('‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë        ‚ñà‚ñà‚ïë   ')}        ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}   ${chalk.hex('#F38181').bold('‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïë   ')}        ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}   ${chalk.hex('#AA96DA').bold('‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ïê‚ïù   ')}        ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}${' '.repeat(63)}${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}        ${chalk.hex('#FFD93D')('üöÄ')} ${chalk.hex('#00D9FF').bold('Ultra Modern Setup')} ${chalk.hex('#FFD93D')('- v3.0.0')}              ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}        ${chalk.gray('Create bleeding-edge web apps instantly!')}         ${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïë')}${' '.repeat(63)}${chalk.hex('#FFD93D')('‚ïë')}
${chalk.hex('#FF6B6B')('‚ïö')}${chalk.hex('#FFA07A')('‚ïê'.repeat(63))}${chalk.hex('#FFD93D')('‚ïù')}
`;

// Clear screen with animation
console.clear();
console.log(banner);

// Animated tips
const tips = [
  `${chalk.hex('#FFD93D')('üí°')} Use ${chalk.hex('#00D9FF').bold('‚Üë‚Üì')} arrow keys to navigate`,
  `${chalk.hex('#FFD93D')('‚ö°')} Press ${chalk.hex('#00D9FF').bold('Enter')} to confirm selection`,
  `${chalk.hex('#FFD93D')('‚ú®')} Selected option glows in ${chalk.hex('#00D9FF').bold('cyan')}`
];

tips.forEach((tip, i) => {
  setTimeout(() => console.log(`   ${tip}`), i * 100);
});
console.log('');

// Enhanced prompts with modern styling
const questions = [
  {
    type: 'input',
    name: 'projectName',
    message: chalk.hex('#FF6B6B').bold('üì¶ Project name:'),
    default: 'my-app',
    prefix: chalk.hex('#00D9FF')('‚ùØ'),
    validate: (input) => {
      if (/^([A-Za-z\-\_\d])+$/.test(input)) return true;
      return chalk.red('‚ùå Only letters, numbers, dashes and underscores allowed');
    },
    transformer: (input) => chalk.hex('#FFD93D')(input)
  },
  {
    type: 'list',
    name: 'framework',
    message: chalk.hex('#FF6B6B').bold('üé® Choose your framework:'),
    prefix: chalk.hex('#00D9FF')('‚ùØ'),
    choices: [
      { name: `${chalk.hex('#61DAFB')('‚öõÔ∏è  React')}     ${chalk.gray('- The UI library everyone loves')}`, value: 'react', short: 'React' },
      { name: `${chalk.hex('#42B883')('üíö Vue')}       ${chalk.gray('- Progressive & powerful')}`, value: 'vue', short: 'Vue' },
      { name: `${chalk.hex('#FF3E00')('üî∫ Svelte')}    ${chalk.gray('- Truly reactive magic')}`, value: 'svelte', short: 'Svelte' },
      { name: `${chalk.hex('#673AB8')('üî∑ Preact')}    ${chalk.gray('- Fast 3KB alternative')}`, value: 'preact', short: 'Preact' },
      { name: `${chalk.hex('#00E8FF')('üî∂ Lit')}       ${chalk.gray('- Web components made simple')}`, value: 'lit', short: 'Lit' },
      { name: `${chalk.hex('#F7DF1E')('‚ö° Vanilla')}   ${chalk.gray('- Pure JS, no framework')}`, value: 'vanilla', short: 'Vanilla' }
    ],
    default: 'react',
    pageSize: 6,
    loop: false
  },
  {
    type: 'list',
    name: 'language',
    message: chalk.hex('#FF6B6B').bold('üìù Select language:'),
    prefix: chalk.hex('#00D9FF')('‚ùØ'),
    choices: [
      { name: `${chalk.hex('#3178C6')('üìò TypeScript')}  ${chalk.gray('- Type-safe & scalable')}`, value: 'typescript', short: 'TypeScript' },
      { name: `${chalk.hex('#F7DF1E')('üìô JavaScript')}  ${chalk.gray('- Classic & flexible')}`, value: 'javascript', short: 'JavaScript' }
    ],
    default: 'javascript',
    loop: false
  },
  {
    type: 'confirm',
    name: 'tailwind',
    message: chalk.hex('#FF6B6B').bold('üé® Add Tailwind CSS v4?') + chalk.gray(' (Latest beta with new engine)'),
    prefix: chalk.hex('#00D9FF')('‚ùØ'),
    default: true,
    when: (answers) => ['react', 'vue', 'svelte', 'preact'].includes(answers.framework),
    transformer: (answer) => answer ? chalk.hex('#00D9FF')('‚úì Yes') : chalk.red('‚úó No')
  },
  {
    type: 'confirm',
    name: 'router',
    message: chalk.hex('#FF6B6B').bold('üß≠ Include router?') + chalk.gray(' (For multi-page apps)'),
    prefix: chalk.hex('#00D9FF')('‚ùØ'),
    default: false,
    when: (answers) => ['react', 'vue', 'svelte'].includes(answers.framework),
    transformer: (answer) => answer ? chalk.hex('#00D9FF')('‚úì Yes') : chalk.red('‚úó No')
  },
  {
    type: 'confirm',
    name: 'folderStructure',
    message: chalk.hex('#FF6B6B').bold('üìÅ Organized folder structure?') + chalk.gray(' (Best practices)'),
    prefix: chalk.hex('#00D9FF')('‚ùØ'),
    default: true,
    transformer: (answer) => answer ? chalk.hex('#00D9FF')('‚úì Yes') : chalk.red('‚úó No')
  }
];

// Helper functions
const getTemplate = (framework, language) => {
  const templates = {
    react: language === 'typescript' ? 'react-ts' : 'react',
    vue: language === 'typescript' ? 'vue-ts' : 'vue',
    svelte: language === 'typescript' ? 'svelte-ts' : 'svelte',
    preact: language === 'typescript' ? 'preact-ts' : 'preact',
    lit: language === 'typescript' ? 'lit-ts' : 'lit',
    vanilla: language === 'typescript' ? 'vanilla-ts' : 'vanilla'
  };
  return templates[framework];
};

// Modern gradient box
const drawModernBox = (title, content) => {
  const width = 60;
  console.log(chalk.hex('#FF6B6B')('‚îå') + chalk.hex('#FFA07A')('‚îÄ'.repeat(width)) + chalk.hex('#FFD93D')('‚îê'));
  console.log(chalk.hex('#FF6B6B')('‚îÇ') + chalk.hex('#00D9FF').bold(title.padEnd(width)) + chalk.hex('#FFD93D')('‚îÇ'));
  console.log(chalk.hex('#FF6B6B')('‚îú') + chalk.hex('#FFA07A')('‚îÄ'.repeat(width)) + chalk.hex('#FFD93D')('‚î§'));
  content.forEach(line => {
    console.log(chalk.hex('#FF6B6B')('‚îÇ') + ' ' + line.padEnd(width - 1) + chalk.hex('#FFD93D')('‚îÇ'));
  });
  console.log(chalk.hex('#FF6B6B')('‚îî') + chalk.hex('#FFA07A')('‚îÄ'.repeat(width)) + chalk.hex('#FFD93D')('‚îò'));
};

async function createProject() {
  try {
    const answers = await inquirer.prompt(questions);
    const { projectName, framework, language, tailwind, router, folderStructure } = answers;
    
    // Framework info with emojis
    const frameworkInfo = {
      react: { emoji: '‚öõÔ∏è', desc: 'Most popular UI library with huge ecosystem', color: '#61DAFB' },
      vue: { emoji: 'üíö', desc: 'Progressive framework easy to learn & powerful', color: '#42B883' },
      svelte: { emoji: 'üî∫', desc: 'Truly reactive with no virtual DOM overhead', color: '#FF3E00' },
      preact: { emoji: 'üî∑', desc: 'Fast 3KB alternative with same API', color: '#673AB8' },
      lit: { emoji: 'üî∂', desc: 'Simple, fast web components', color: '#00E8FF' },
      vanilla: { emoji: '‚ö°', desc: 'Pure JavaScript with no framework', color: '#F7DF1E' }
    };
    
    console.log('\n' + chalk.hex(frameworkInfo[framework].color)('  ‚úì Selected: ') + 
                frameworkInfo[framework].emoji + ' ' + 
                chalk.hex('#00D9FF').bold(framework.toUpperCase()));
    console.log(chalk.gray('    ' + frameworkInfo[framework].desc) + '\n');
    
    const projectPath = path.join(process.cwd(), projectName);
    const template = getTemplate(framework, language);
    const isTypeScript = language === 'typescript';
    
    // Configuration summary
    console.log('\n');
    drawModernBox('  üìã YOUR CONFIGURATION', [
      '',
      `  ${chalk.gray('Project:')}      ${chalk.hex('#00D9FF').bold(projectName)}`,
      `  ${chalk.gray('Framework:')}    ${chalk.hex('#00D9FF').bold(framework.toUpperCase())}`,
      `  ${chalk.gray('Language:')}     ${chalk.hex('#00D9FF').bold(isTypeScript ? 'TypeScript' : 'JavaScript')}`,
      `  ${chalk.gray('Tailwind v4:')}  ${tailwind ? chalk.hex('#00D9FF').bold('‚úì Yes') : chalk.red.bold('‚úó No')}`,
      `  ${chalk.gray('Router:')}       ${router ? chalk.hex('#00D9FF').bold('‚úì Yes') : chalk.red.bold('‚úó No')}`,
      `  ${chalk.gray('Structure:')}    ${folderStructure ? chalk.hex('#00D9FF').bold('‚úì Yes') : chalk.red.bold('‚úó No')}`,
      ''
    ]);
    console.log('\n');
    
    // 1. Create Vite project
    const spinner = ora({
      text: chalk.hex('#00D9FF')(`Creating ${framework} project with latest Vite...`),
      color: 'cyan',
      spinner: 'dots12'
    }).start();
    
    execSync(`npm create vite@latest ${projectName} -- --template ${template}`, { stdio: 'inherit' });
    spinner.succeed(chalk.hex('#00D9FF')(`‚úì ${framework.charAt(0).toUpperCase() + framework.slice(1)} project created!`));
    
    process.chdir(projectPath);
    
    // 2. Install dependencies
    spinner.start(chalk.hex('#00D9FF')('Installing dependencies...'));
    execSync('npm install', { stdio: 'ignore' });
    spinner.succeed(chalk.hex('#00D9FF')('‚úì Dependencies installed!'));
    
    // 3. Setup Tailwind CSS v4 (LATEST BETA!)
    if (tailwind) {
      spinner.start(chalk.hex('#00D9FF')('Setting up Tailwind CSS v4 (Next-gen engine)...'));
      
      try {
        // Install Tailwind v4 beta with Vite plugin
        execSync('npm install -D tailwindcss@next @tailwindcss/vite@next', { stdio: 'ignore' });
        
        // Update vite.config
        const viteConfigFile = isTypeScript ? 'vite.config.ts' : 'vite.config.js';
        
        if (fs.existsSync(viteConfigFile)) {
          let viteConfig = fs.readFileSync(viteConfigFile, 'utf8');
          
          // Add Tailwind import
          const importLine = "import tailwindcss from '@tailwindcss/vite'";
          if (!viteConfig.includes(importLine)) {
            const lines = viteConfig.split('\n');
            const lastImportIndex = lines.findLastIndex(line => line.includes('import'));
            lines.splice(lastImportIndex + 1, 0, importLine);
            viteConfig = lines.join('\n');
          }
          
          // Add to plugins array
          if (!viteConfig.includes('tailwindcss()')) {
            viteConfig = viteConfig.replace(
              /plugins:\s*\[/,
              'plugins: [\n    tailwindcss(),'
            );
          }
          
          fs.writeFileSync(viteConfigFile, viteConfig);
        }
        
        // Use new @import syntax for Tailwind v4
        const cssContent = `@import "tailwindcss";

/* Your custom styles below */
`;
        
        const cssFiles = ['src/index.css', 'src/style.css', 'src/app.css'];
        const cssFile = cssFiles.find(file => fs.existsSync(file)) || 'src/index.css';
        fs.ensureFileSync(cssFile);
        fs.writeFileSync(cssFile, cssContent);
        
        spinner.succeed(chalk.hex('#00D9FF')('‚úì Tailwind CSS v4 configured!'));
        console.log(chalk.gray('    Using latest @import syntax with Vite plugin'));
      } catch (error) {
        spinner.fail(chalk.red('‚úó Tailwind setup failed'));
        console.log(chalk.yellow('  Error: ' + error.message));
      }
    }
    
    // 4. Setup Router
    if (router) {
      spinner.start(chalk.hex('#00D9FF')(`Setting up ${framework} router...`));
      
      const routerPackages = {
        react: 'react-router-dom@latest',
        vue: 'vue-router@latest',
        svelte: 'svelte-routing@latest'
      };
      
      execSync(`npm install ${routerPackages[framework]}`, { stdio: 'ignore' });
      spinner.succeed(chalk.hex('#00D9FF')(`‚úì Latest ${framework} router installed!`));
    }
    
    // 5. Folder structure
    if (folderStructure) {
      spinner.start(chalk.hex('#00D9FF')('Creating organized structure...'));
      
      const folders = framework === 'vue' 
        ? ['components', 'views', 'composables', 'assets', 'stores']
        : framework === 'svelte'
        ? ['components', 'routes', 'stores', 'assets', 'lib']
        : ['components', 'pages', 'hooks', 'utils', 'assets'];
      
      folders.forEach(folder => {
        const folderPath = path.join('src', folder);
        fs.ensureDirSync(folderPath);
        
        const descriptions = {
          components: 'Reusable UI components',
          pages: 'Page components',
          views: 'Vue page components',
          routes: 'Svelte route components',
          hooks: 'Custom React hooks',
          composables: 'Vue composable functions',
          stores: 'State management',
          utils: 'Utility functions',
          lib: 'Library code',
          assets: 'Images, fonts, static files'
        };
        
        const readmeContent = `# ${folder.charAt(0).toUpperCase() + folder.slice(1)}\n\n${descriptions[folder] || 'Your code here'}`;
        fs.writeFileSync(path.join(folderPath, 'README.md'), readmeContent);
      });
      
      spinner.succeed(chalk.hex('#00D9FF')('‚úì Folder structure created!'));
    }
    
    // 6. Create README
    const readmeContent = `# ${projectName}

${frameworkInfo[framework].emoji} Built with ${framework.charAt(0).toUpperCase() + framework.slice(1)} ${isTypeScript ? '+ TypeScript' : ''}

## üöÄ Tech Stack

- **Framework:** ${framework.charAt(0).toUpperCase() + framework.slice(1)} (Latest)
- **Language:** ${isTypeScript ? 'TypeScript' : 'JavaScript'}
- **Build Tool:** Vite 5+ (Lightning fast HMR)
${tailwind ? '- **Styling:** Tailwind CSS v4 (Next-gen engine)\n' : ''}${router ? `- **Router:** Latest routing solution\n` : ''}
## üéØ Quick Start

\`\`\`bash
npm run dev
\`\`\`

Open [http://localhost:5173](http://localhost:5173)

## üì¶ Scripts

- \`npm run dev\` - Start dev server
- \`npm run build\` - Production build
- \`npm run preview\` - Preview production build

## üìö Learn More

- [${framework.charAt(0).toUpperCase() + framework.slice(1)} Docs](${frameworkInfo[framework] === 'react' ? 'https://react.dev' : ''})
- [Vite Docs](https://vitejs.dev)
${tailwind ? '- [Tailwind v4 Docs](https://tailwindcss.com/docs/v4-beta)\n' : ''}
Happy coding! üíª‚ú®
`;
    
    fs.writeFileSync('README.md', readmeContent);
    
    // Success message
    const frameworkEmojis = {
      react: '‚öõÔ∏è', vue: 'üíö', svelte: 'üî∫',
      preact: 'üî∑', lit: 'üî∂', vanilla: '‚ö°'
    };
    
    console.log('\n');
    console.log(chalk.hex('#FF6B6B')('‚ïê'.repeat(65)));
    console.log(chalk.hex('#00D9FF').bold('  ‚ú® SUCCESS! Your project is ready to rock! ‚ú®'));
    console.log(chalk.hex('#FF6B6B')('‚ïê'.repeat(65)));
    console.log('');
    console.log(chalk.hex('#FFD93D').bold('  üìÇ Project:'), chalk.white(projectName), frameworkEmojis[framework]);
    console.log('');
    console.log(chalk.hex('#FF6B6B').bold('  üöÄ Next Steps:'));
    console.log('');
    console.log(chalk.white('     1.'), chalk.hex('#00D9FF')(`cd ${projectName}`));
    console.log(chalk.white('     2.'), chalk.hex('#00D9FF')('npm run dev'));
    console.log(chalk.white('     3.'), chalk.hex('#00D9FF')('Open http://localhost:5173'));
    console.log('');
    
    if (tailwind) {
      console.log(chalk.hex('#FFD93D').bold('  üí° Tailwind v4 Tip:'));
      console.log(chalk.gray('     Try: ') + chalk.white('className="bg-gradient-to-r from-blue-500 to-purple-600"'));
      console.log(chalk.gray('     New features: Enhanced gradients, better performance!'));
      console.log('');
    }
    
    if (router) {
      console.log(chalk.hex('#00D9FF').bold('  üß≠ Router Docs:'));
      const routerDocs = {
        react: 'https://reactrouter.com',
        vue: 'https://router.vuejs.org',
        svelte: 'https://github.com/EmilTholin/svelte-routing'
      };
      console.log(chalk.gray(`     ${routerDocs[framework]}`));
      console.log('');
    }
    
    console.log(chalk.hex('#FF6B6B')('‚ïê'.repeat(65)));
    console.log(chalk.gray('  Need help? Check README.md or visit docs!'));
    console.log(chalk.hex('#FF6B6B')('‚ïê'.repeat(65)));
    console.log('');
    
  } catch (error) {
    console.log('');
    console.log(chalk.red('‚ïê'.repeat(65)));
    console.log(chalk.red.bold('  ‚ùå ERROR'));
    console.log(chalk.red('‚ïê'.repeat(65)));
    console.log('');
    console.log(chalk.white('  Message:'), chalk.hex('#FFD93D')(error.message));
    console.log('');
    console.log(chalk.hex('#00D9FF')('  üí° Troubleshooting:'));
    console.log(chalk.white('     ‚Ä¢ Check internet connection'));
    console.log(chalk.white('     ‚Ä¢ Ensure Node.js >= 18 (node --version)'));
    console.log(chalk.white('     ‚Ä¢ Try running again'));
    console.log('');
    console.log(chalk.red('‚ïê'.repeat(65)));
    console.log('');
    process.exit(1);
  }
}

createProject();
